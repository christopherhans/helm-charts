kind: ConfigMap
apiVersion: v1
metadata:
  name: elastiflow-nginx-config
  labels:
    app: "{{ template "logstash.fullname" . }}-nginx"
    chart: "{{ .Chart.Name }}"
    heritage: {{ .Release.Service | quote }}
    release: {{ .Release.Name | quote }}
data:
  nginx.conf: |
    user nginx;
    worker_processes  5;
    error_log  /dev/stdout info;
    events {
      worker_connections  10240;
    }

    stream {

      upstream logstash_udp_upstream {
        server localhost:2055;
      }
      server {
          listen 2055 udp;
          proxy_protocol on
          proxy_pass logstash_udp_upstream;
          proxy_responses 0;
          proxy_buffer_size 16384k;
          proxy_bind $proxy_protocol_addr:$proxy_protocol_port transparent;
      }
    }
